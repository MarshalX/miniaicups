# Rewind viewer для Mini AI Cup #4 (PaperIO)

Удобная отладка ваших стратегий с использованием быстрого визуалитора
с возможностью перемотки, добавлению своих объектов с отладочной
информацией.

## Добавленные фичи

- Вся отрисовка из оригинального ЛРа теперь в rewind'е;
- Возможность добавлять свои объекты следующих типов:
    - cell;
    - cell_popup;
    - circle;
    - rectangle;
    - line;
    - popup;
    - message.
- Отключение логирования (в constants.py `SAVE = False`).

## Установка

### Перед установкой прочитайте примечание, у Вас могут появиться дополнительные шаги!

- Склонить репу [rewind-viewer](https://github.com/kswaldemar/rewind-viewer).
- Изменить в Renderer.cpp 57 строку на `attr_->grid_model = glm::scale(glm::mat4{1.0}, {area_size_.x, area_size_.y, 1.0f})`.
- Собрать.
- Скопировать папку resources в Вашу папку сборки.
- В конфиге визуализатора (rewindviewer.cfg) сделать следующие изменения:
    - изменить количество клеток сетки (`scene.grid_cells_count = (31, 31)`);
    - изменить размер сцены (`scene.grid_dim = (930, 930)`).
    
## Запуск

- Запустите Rewind viewer.
- Запустите модифицированный Local Runner c Вашей стратегией (клавиатура не поддерживается).

## Примечание 

На первом слою рисуется игра, полностью вся, остальные слои для дебаг
вывода стратегий. Номера слоям расставляются по порядку (порядок как в офф. ЛРе).
Слоёв из коробки 5 и один из них уже занят картой. В итоге слоёв хватает только на 4 игрока.
Для увеличения количества необходимо перед сборкой потрогать следующие строки:
- [Frame.h#L28](https://github.com/kswaldemar/rewind-viewer/blob/master/src/viewer/Frame.h#L28)
- [Config.h#L28](https://github.com/kswaldemar/rewind-viewer/blob/master/src/viewer/Config.h#L28)

Однако сам я этого не проверял!

Ещё данный визуализатор не поддерживает киллирические символы!
Я не стал в этом разбираться и просто перевёл на английский. 

## Добавление своих объектов

Гайдос писать не буду, все Вы программисты, просто теперь появилось
третье поле в ответе страты.

Раньше: 

````
{"command": cmd, 'debug': cmd}
````

Сейчас: 

````
{"command": cmd, 'debug': cmd, 'rewind': obj_list}
````

obj_list представляет из себя список словарей, которые потом будут
сериализованы в JSON и отправлены в Rewind.

Пример объекта:

```
{
    'type': 'popup',
    'x': 100,
    'y': 100,
    'r': 30,
    'text': 'Это окно при наведении на указанную область'
}
```

Моё решение на питоне, мне достаточно удобно написать обёртку для
таких словарей (кстати она есть в clients.py, класс RewindClient),
для других же, наверное, было бы куда удобнее пихать туда готовый JSON объекта.
Перепишите пару строк :)

Примеры клиентов на разных языках для Rewind Viewer'a доступны [тут](https://github.com/kswaldemar/rewind-viewer/tree/master/clients).

## Благодарности

@kswaldemar за Rewind viewer который всё переиспользуют и переиспользуют в других чемпионатах.

@mortido за изменения в Renderer.cpp и помощь в знакомстве с данным визуализатором.


## Отказ от ответственности

Сами понимаете, мне не интересно как Вы будете это использовать и
будете ли. Я не обещаю никакой дальнейшей поддержки, обновления под
новые версии офф. ЛРа. Делал для себя, просто решил поделиться со всеми.

## Скриншоты

![screen1](https://i.imgur.com/8Q71Bcc.png)

![screen2](https://i.imgur.com/K9dvCmL.png)

![screen3](https://i.imgur.com/mVTpzFn.png)